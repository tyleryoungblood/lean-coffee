"use strict";function countDown(a,b){var c=document.getElementById(b);min=Math.floor(a/60),sec=a-60*min,10>sec&&(sec="0"+sec),c.innerHTML="Discussion Time Remaining: <b>"+min+":"+sec+"</b>",1>a?c.innerHTML="Time has expired. <button onclick=\"countDown(5, 'status')\">Restart?</button>":(a--,timer=setTimeout("countDown("+a+', "'+b+'")',1e3))}var app=angular.module("leanCoffeeApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]);app.constant("FIREBASE_URL","https://blazing-fire-8085.firebaseio.com/"),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/meeting.html",controller:"TopicsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/instructions",{templateUrl:"views/instructions.html",controller:""}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl"}).when("/submit_topic",{templateUrl:"views/submit_topic.html",controller:"NavCtrl"}).when("/topics/:topicId",{templateUrl:"views/showtopic.html",controller:"TopicViewCtrl"}).when("/users/:username",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("AuthCtrl",["$scope","$location","Auth","User",function(a,b,c,d){c.signedIn()&&b.path("/"),a.$on("$firebaseSimpleLogin:login",function(){b.path("/")}),a.login=function(){c.login(a.user).then(function(){b.path("/")},function(b){a.error=b.toString().replace("FirebaseSimpleLogin: FirebaseSimpleLogin: ","")})},a.register=function(){c.register(a.user).then(function(e){c.login(a.user),d.create(e,a.user.username),b.path("/")},function(b){a.error=b.toString().replace("FirebaseSimpleLogin: FirebaseSimpleLogin: ","")})}}]),app.controller("NavCtrl",["$scope","$location","Topic","Auth",function(a,b,c,d){a.logout=function(){d.logout()},a.currentPath=b.path(),a.topics=c.all,a.topic={title:"",description:""},a.submitTopic=function(){c.create(a.topic).then(function(c){c("Thanks! Your topic has been created!"),b.path("/#"),a.topic={url:"http://",title:""}})}}]),app.controller("ProfileCtrl",["$scope","$routeParams","Topic","User",function(a,b,c,d){function e(){a.topics={},angular.forEach(a.user.topics,function(b){a.topics[b]=c.find(b)})}function f(){a.comments={},angular.forEach(a.user.comments,function(b){var d=c.find(b.topicId);d.$on("loaded",function(){a.comments[b.id]=d.$child("comments").$child(b.id),a.commentedTopics[b.topicId]=d})})}a.user=d.findByUsername(b.username),a.commentedTopics={},a.user.$on("loaded",function(){e(),f()})}]),app.controller("TopicsCtrl",["$scope","$location","Topic",function(a,b,c){"/"===b.path()&&(a.topics=c.all),a.topic={title:"Topic Title",description:"Description"},a.deleteTopic=function(a){c.delete(a)},a.upVoteTopic=function(a,b){b?c.clearVote(a,b):c.upVote(a)},a.downVoteTopic=function(a,b){b?c.clearVote(a,!b):c.downVote(a)},a.upVoted=function(a){return c.upVoted(a)},a.downVoted=function(a){return c.downVoted(a)}}]),app.controller("TopicViewCtrl",["$scope","$routeParams","Topic",function(a,b,c){a.topic=c.find(b.topicId),a.addComment=function(){c.addComment(b.topicId,a.comment),a.comment=""},a.removeComment=function(b,d){c.deleteComment(a.topic,b,d)},a.upVoteTopic=function(a){a?c.clearVote(b.topicId,!0):c.upVote(b.topicId)},a.downVoteTopic=function(a){a?c.clearVote(b.topicId,!1):c.downVote(b.topicId)},a.upVoted=function(){return c.upVoted(a.topic)},a.downVoted=function(){return c.downVoted(a.topic)}}]),app.directive("checkUsername",["User",function(a){var b=/^[^.$\[\]#\/\s]+$/;return{require:"ngModel",link:function(c,d,e,f){f.$parsers.unshift(function(c){return b.test(c)?0===a.findByUsername(c).$getIndex().length?(f.$setValidity("taken",!0),f.$setValidity("invalid",!0),c):(f.$setValidity("taken",!1),void f.$setValidity("invalid",!0)):(f.$setValidity("taken",!0),void f.$setValidity("invalid",!1))})}}}]),app.filter("hostnameFromUrl",function(){return function(a){var b=document.createElement("a");return b.href=a,b.hostname}}),app.factory("Auth",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope",function(a,b,c){var d=new Firebase(b),e=a(d);window.auth=e;var f={register:function(a){return e.$createUser(a.email,a.password)},signedIn:function(){return null!==e.user},login:function(a){return e.$login("password",a)},logout:function(){e.$logout()}};return c.signedIn=function(){return f.signedIn()},f}]),app.factory("Topic",["$firebase","FIREBASE_URL","User",function(a,b,c){var d=new Firebase(b+"topics"),e=a(d),f={all:e,create:function(a){if(c.signedIn()){var b=c.getCurrent();return a.owner=b.username,a.score=0,e.$add(a).then(function(a){var c=a.name();return b.$child("topics").$child(c).$set(c),c})}},find:function(a){return e.$child(a)},"delete":function(a){if(c.signedIn()){var b=f.find(a);b.$on("loaded",function(){var d=c.findByUsername(b.owner);e.$remove(a).then(function(){d.$child("topics").$remove(a)})})}},addComment:function(a,b){if(c.signedIn()){var d=c.getCurrent();b.username=d.username,b.topicId=a,e.$child(a).$child("comments").$add(b).then(function(b){d.$child("comments").$child(b.name()).$set({id:b.name(),topicId:a})})}},deleteComment:function(a,b,d){if(c.signedIn()){var e=c.findByUsername(b.username);a.$child("comments").$remove(d).then(function(){e.$child("comments").$remove(d)})}},upVote:function(a){if(c.signedIn()){var b=c.getCurrent(),d=e.$child(a);d.$child("upvotes").$child(b.username).$set(b.username).then(function(){b.$child("upvotes").$child(a).$set(a),d.$child("downvotes").$remove(b.username),b.$child("downvotes").$remove(a),d.$child("score").$transaction(function(a){return a?a+1:1})})}else window.alert("You Must Be Signed In To Vote")},downVote:function(a){if(c.signedIn()){var b=c.getCurrent(),d=e.$child(a);d.$child("downvotes").$child(b.username).$set(b.username).then(function(){b.$child("downvotes").$child(a).$set(a),d.$child("upvotes").$remove(b.username),b.$child("upvotes").$remove(a),d.$child("score").$transaction(function(a){return void 0===a||null===a?-1:a-1})})}},clearVote:function(a,b){if(c.signedIn()){var d=c.getCurrent(),f=d.username,g=e.$child(a);g.$child("upvotes").$remove(f),g.$child("downvotes").$remove(f),d.$child("upvotes").$remove(a),d.$child("downvotes").$remove(a),g.$child("score").$transaction(function(a){return b?a-1:a+1})}},upVoted:function(a){return c.signedIn()&&a.upvotes?a.upvotes.hasOwnProperty(c.getCurrent().username):void 0},downVoted:function(a){return c.signedIn()&&a.downvotes?a.downvotes.hasOwnProperty(c.getCurrent().username):void 0}};return f}]),app.factory("User",["$firebase","FIREBASE_URL","$rootScope",function(a,b,c){function d(a){c.currentUser=g.findByUsername(a)}var e=new Firebase(b+"users"),f=a(e),g={create:function(a,b){f[b]={md5_hash:a.md5_hash,username:b,$priority:a.uid},f.$save(b).then(function(){d(b)})},findByUsername:function(a){return a?f.$child(a):void 0},getCurrent:function(){return c.currentUser},signedIn:function(){return void 0!==c.currentUser}};return c.$on("$firebaseSimpleLogin:login",function(b,c){var f=a(e.startAt(c.uid).endAt(c.uid));f.$on("loaded",function(){d(f.$getIndex()[0])})}),c.$on("firebaseSimpleLogin:logout",function(){delete c.currentUser}),g}]);var time,min,sec,timer;$(document).on("click",".navbar-collapse.in",function(a){$(a.target).is("a")&&$(this).collapse("hide")}),angular.module("leanCoffeeApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);